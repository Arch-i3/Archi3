#!/bin/bash

STATE_FILE="/tmp/memory_block_state"

# Ha nincs állapotfájl, alapértelmezés: rövid mód
if [ ! -f "$STATE_FILE" ]; then
    echo "short" > "$STATE_FILE"
fi

state=$(cat "$STATE_FILE")

used=$(free -m | awk '/Mem:/ {print $3}')
total=$(free -m | awk '/Mem:/ {print $2}')
percent=$((100 * $used / $total))

color="#6c71c4"
[ $percent -ge 80 ] && color="#FF0000"
[ $percent -ge 50 ] && color="#FFFF00"

# Ha bal kattintás történt, váltunk az állapotban
if [ "$BLOCK_BUTTON" == "1" ]; then
    if [ "$state" == "short" ]; then
        echo "long" > "$STATE_FILE"
        state="long"
    else
        echo "short" > "$STATE_FILE"
        state="short"
    fi
fi

# Kimenet az aktuális állapot szerint
if [ "$state" == "long" ]; then
    echo "󰍛 ${used}M/${total}M (${percent}%)"   # full_text
    echo "󰍛 ${used}M"                           # short_text
else
    echo "󰍛 ${used}M"                           # full_text
    echo "󰍛"                                     # short_text
fi

echo $color
exit 0
